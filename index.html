<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Bootstrap demo</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <style>
            #content_table_users{
                box-shadow: rgba(50, 50, 93, 0.25) 0px 6px 12px -2px, rgba(0, 0, 0, 0.3) 0px 3px 7px -3px;
                padding: 40px 40px;
                border-radius: 6px;
                background-color: white;
                margin-top: 20px;
            }
            #content_add{
                box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
                padding: 20px 40px;
                border-radius: 6px;
                display: flex;
                width: 100%;
                background-color: white;
                margin-top: 20px;
            }
            #content_btn_add{
                width: 100%;
            }
            #content_add #content_btn_add button{
                float: right;
                background-color: #FFAA0A;
                color: #6A6459;
                border: none;
                padding: 8px 40px;
            }
            .etat{
                padding: 4px 8px;
                margin: 0px;
                color: white;
                border-radius: 8px;
                font-size: 14px;
                text-align: center;
            }
            .valide {
                background-color: #5BE881;
            }
            .rejected {
                background-color: #FF0000;
            }
            .on-validation {
                background-color: #FDB64D;
            }

            /*  */
            .content_fotm_add{
                display: flex;
                width: 100%;
                justify-content: space-between;
            }
            .element_fotm_add{
                width: 30%;
            }
            #button_add{
                float: right;
                background-color: #FFAA0A;
                color: #6A6459;
                border: none;
                padding: 8px 40px;
            }
            .modal-content_shadow{
                box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
            }
        </style>
    </head>
    <body>
        <section>
            <div class="container" >
                <div id="content_table_users">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col"><p class="m-0">ID</p></th>
                                <th scope="col"><p class="m-0">Date de création</p></th>
                                <th scope="col"><p class="text-center m-0">Etat</p></th>
                                <th scope="col"><p class="m-0">Nom</p></th>
                                <th scope="col"><p class="m-0">Prénom</p></th>
                                <th scope="col"><p class="m-0">Nom d'utilisateur</p></th>
                                <th scope="col"><p class="m-0">Matricule</p></th>
                                <th scope="col"><p class="text-center m-0">Action</p></th>
                            </tr>
                        </thead>
                        <tbody id="tbody_table_user">

                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        <section>
            <div class="container" >
                <div id="content_add">
                    <div id="content_btn_add">
                        <button class="btn btn-primary" type="button"  data-bs-toggle="modal" data-bs-target="#exampleModal">Ajouter utilisateur</button>
                    </div>
                </div>
            </div>


            <!-- ------------- -->
            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content modal-content_shadow">
                        <div class="modal-header  border-0">
                            <h2 class="modal-title mb-2">Ajout d'utilisateurs</h2>
                            <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
                        </div>
                        <div class="modal-body">
                            <div>
                                <form>
                                    <div class="content_fotm_add" >
                                        <div class="element_fotm_add" >
                                            <div class="mb-3">
                                                <label for="nom" class="form-label">Nom</label>
                                                <input type="text" class="form-control" id="nom" name="nom" aria-describedby="">
                                                <div id="msgValig_nom" class="form-text"></div>
                                            </div>
                                        </div>
                                        <div class="element_fotm_add">
                                            <div class="mb-3">
                                                <label for="prenom" class="form-label">Prénom</label>
                                                <input type="text" class="form-control" id="prenom" name="prenom" aria-describedby="">
                                                <div id="msgValig_prenom" class="form-text"></div>
                                            </div>
                                        </div>
                                        <div class="element_fotm_add" >
                                            <div class="mb-3">
                                                <label for="etat" class="form-label">Etat</label>
                                                <select id="dropdown_Etat"class="form-select">
                                                    <option value="En validation" >En validation</option>
                                                    <option value="Validé" >Validé</option>
                                                    <option value="Rejeté" >Rejeté</option>
                                                </select>
                                                <div id="msgValig_Etat" class="form-text"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="content_fotm_add" >
                                        <div class="element_fotm_add" >
                                            <div class="mb-3">
                                                <label for="nom_dutilisateur" class="form-label">Nom d'utilisateur</label>
                                                <input type="text" class="form-control" id="nom_dutilisateur" name="nom_dutilisateur" aria-describedby="">
                                                <div id="msgValig_nom_dutilisateur" class="form-text"></div>
                                            </div>
                                        </div>
                                        <div class="element_fotm_add">
                                            <div class="mb-3">
                                                <label for="date_creation" class="form-label">Date de création</label>
                                                <input type="datetime-local" class="form-control" id="date_creation" name="date_creation" aria-describedby="">
                                                <div id="msgValig_date_creation" class="form-text"></div>
                                            </div>
                                        </div>
                                        <div class="element_fotm_add" >
                                        </div>
                                    </div>
                                    <div class="content_fotm_add" >
                                        <div class="element_fotm_add" >
                                            <div class="mb-3">
                                                <label for="matricule" class="form-label">Matricule</label>
                                                <input type="text" class="form-control" id="matricule" name="matricule" aria-describedby="">
                                                <div id="msgValig_matricule" class="form-text">.</div>
                                            </div>
                                        </div>
                                        <div class="element_fotm_add">
                                        </div>
                                        <div class="element_fotm_add" >
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="modal-footer border-0">
                            <button type="button" class="btn btn-primary" id="button_add" onclick="createUser()">Enregistrer</button>
                            <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button> -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!--  -->
        <script>
            // -
            var tbody_table_user = document.getElementById('tbody_table_user');
            debugger;
            let usersDataStorage = JSON.parse(localStorage.getItem("userList"));
            if(localStorage.getItem("userList") === null){ 
                let users = [
                    {
                        id: "123456789",
                        createdDate: "2021-01-06T00:00:00.000Z",
                        status: "En validation",
                        firstName: "Mohamed",
                        lastName: "Taha",
                        userName: "mtaha",
                        registrationNumber: "2584",
                    },
                    {
                        id: "987654321",
                        createdDate: "2021-07-25T00:00:00.000Z",
                        status: "Validé",
                        firstName: "Hamid",
                        lastName: "Orrich",
                        userName: "horrich",
                        registrationNumber: "1594",
                    },
                    {
                        id: "852963741",
                        createdDate: "2021-09-15T00:00:00.000Z",
                        status: "Rejeté",
                        firstName: "Rachid",
                        lastName: "Mahidi",
                        userName: "rmahidi",
                        registrationNumber: "3576",
                    }
                ]
                localStorage.setItem("userList",JSON.stringify(users));
                fetchUsers();
            }
            else if(usersDataStorage.length == 0){
                tbody_table_user.innerHTML = "<tr><td colspan='8'><center>No data 2</center></td></tr>";
            }
            else{
                fetchUsers();
            }

            const createUser = () => {
                const lastName = document.querySelector('#nom').value;
                const firstName = document.querySelector('#prenom').value;
                const status = document.querySelector('#dropdown_Etat').value;
                const userName = document.querySelector('#nom_dutilisateur').value;
                const createdDate = document.querySelector('#date_creation').value;
                const registrationNumber = document.querySelector('#matricule').value;
                const id = Math.floor(Math.random() * 100000000);
                var controlValid = 0 ;

                // Validation lastName
                if(lastName == ""){
                    document.querySelector('#nom').setAttribute('class','form-control is-invalid');
                    document.querySelector('#msgValig_nom').setAttribute('class','invalid-feedback');
                    document.querySelector('#msgValig_nom').innerHTML = "Le Nom est obligatoire !";
                    controlValid ++;
                }else if(lastName != ""){
                    document.querySelector('#nom').setAttribute('class','form-control is-valid');
                    document.querySelector('#msgValig_nom').setAttribute('class','valid-feedback');
                    document.querySelector('#msgValig_nom').innerHTML = "";
                }
                // Validation firstName
                if(firstName == ""){
                    document.querySelector('#prenom').setAttribute('class','form-control is-invalid');
                    document.querySelector('#msgValig_prenom').setAttribute('class','invalid-feedback');
                    document.querySelector('#msgValig_prenom').innerHTML = "Le Prenom est obligatoire !";
                    controlValid ++;
                }else if(firstName != ""){
                    document.querySelector('#prenom').setAttribute('class','form-control is-valid');
                    document.querySelector('#msgValig_prenom').setAttribute('class','valid-feedback');
                    document.querySelector('#msgValig_prenom').innerHTML = "";
                }
                // Validation status
                if(status == ""){
                    document.querySelector('#dropdown_Etat').setAttribute('class','form-control is-invalid');
                    document.querySelector('#msgValig_Etat').setAttribute('class','invalid-feedback');
                    document.querySelector('#msgValig_Etat').innerHTML = "L'Etat est obligatoire !";
                    controlValid ++;
                }else if(status != ""){
                    document.querySelector('#dropdown_Etat').setAttribute('class','form-control is-valid');
                    document.querySelector('#msgValig_Etat').setAttribute('class','valid-feedback');
                    document.querySelector('#msgValig_Etat').innerHTML = "";
                }
                // Validation userName
                if(userName == ""){
                    document.querySelector('#nom_dutilisateur').setAttribute('class','form-control is-invalid');
                    document.querySelector('#msgValig_nom_dutilisateur').setAttribute('class','invalid-feedback');
                    document.querySelector('#msgValig_nom_dutilisateur').innerHTML = "Le Nom d'utilisateur est obligatoire !";
                    controlValid ++;
                }else if(userName != ""){
                    document.querySelector('#nom_dutilisateur').setAttribute('class','form-control is-valid');
                    document.querySelector('#msgValig_nom_dutilisateur').setAttribute('class','valid-feedback');
                    document.querySelector('#msgValig_nom_dutilisateur').innerHTML = "";
                }
                // Validation createdDate
                if(createdDate == ""){
                    document.querySelector('#date_creation').setAttribute('class','form-control is-invalid');
                    document.querySelector('#msgValig_date_creation').setAttribute('class','invalid-feedback');
                    document.querySelector('#msgValig_date_creation').innerHTML = "La Date de création est obligatoire !";
                    controlValid ++;
                }else if(createdDate != ""){
                    document.querySelector('#date_creation').setAttribute('class','form-control is-valid');
                    document.querySelector('#msgValig_date_creation').setAttribute('class','valid-feedback');
                    document.querySelector('#msgValig_date_creation').innerHTML = "";
                }
                // Validation registrationNumber
                if(registrationNumber == ""){
                    document.querySelector('#matricule').setAttribute('class','form-control is-invalid');
                    document.querySelector('#msgValig_matricule').setAttribute('class','invalid-feedback');
                    document.querySelector('#msgValig_matricule').innerHTML = "Le Matricule est obligatoire !";
                    controlValid ++;
                }else if(registrationNumber != ""){
                    document.querySelector('#matricule').setAttribute('class','form-control is-valid');
                    document.querySelector('#msgValig_matricule').setAttribute('class','valid-feedback');
                    document.querySelector('#msgValig_matricule').innerHTML = "";
                }



                if(controlValid == 0){
                    const formData = {
                        id,
                        createdDate,
                        status,
                        firstName,
                        lastName,
                        userName,
                        registrationNumber
                    }
                    let users = [];
                    users.push(formData);
                    console.log(users);
                    try{
                        if(localStorage.getItem("userList") === null){
                            localStorage.setItem("userList", JSON.stringify(users));
                        }else{
                            let storage = JSON.parse(localStorage.getItem("userList"));
                            storage.push(formData);
                            localStorage.setItem("userList",JSON.stringify(storage));
                            console.log(storage);
                        }
                        window.location.reload();
                    }catch (err) {
                        console.log(err);
                    }
                }



                
            }


            const deleteUser = (id) => {
                let confirm = window.confirm("Êtes-vous sûr de bien vouloir supprimer cet élément");
                if(confirm === true){                   
                    let users = JSON.parse(localStorage.getItem("userList"));
                    let users2 = JSON.parse(localStorage.getItem("userList")); 
                    for (var i = 0, len = users.length; i < len; i++) {
                        if(parseInt(users[i].id) == parseInt(id)){
                            users2.splice(i, 1);
                        }
                    }
                    localStorage.setItem("userList",JSON.stringify(users2));
                    window.location.reload();
                }else{
                    return;
                }
            }

            function fetchUsers(){
                var tbody_table_user = document.getElementById('tbody_table_user');
                var tbody = "";
                let users = JSON.parse(localStorage.getItem("userList"));
                if(users.length > 0){
                    for (var i = 0, len = users.length; i < len; i++) {
                        tbody += "<tr><th scope='row'>"+users[i].id+"</th><td>"+users[i].createdDate+"</td>";
                        if(users[i].status === "Validé"){
                            tbody += "<td class='content_center'><center><p class='etat valide' >"+users[i].status+"</p></center></td>";
                        }else if(users[i].status === "Rejeté"){
                            tbody += "<td class='content_center'><center><p class='etat rejected' >"+users[i].status+"</p></center></td>";
                        }else if(users[i].status === "En validation"){
                            tbody += "<td class='content_center'><center><p class='etat on-validation' >"+users[i].status+"</p></center></td>";
                        }
                        tbody += "<td>"+users[i].lastName+"</td><td>"+users[i].firstName+"</td><td>"+users[i].userName+"</td><td>"+users[i].registrationNumber+"</td><td><center><a href='#' class='text-dark' onclick='deleteUser("+users[i].id+")'><i class='fa-solid fa-trash-can'></i></a></center></td></tr>";
                    }
                    tbody_table_user.innerHTML = tbody;
                }else{
                    tbody_table_user.innerHTML = "<tr><td colspan='8'><center>No data</center></td></tr>";
                }
            }
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
    </body>
</html>